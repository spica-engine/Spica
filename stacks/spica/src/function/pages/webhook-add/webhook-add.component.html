<mat-toolbar color="primary">
  <h4 class="mat-h4">
    <mat-icon>http</mat-icon>
    <span>{{ webhook._id ? "Edit Webhook" : "New Webhook" }}</span>
  </h4>
</mat-toolbar>
<mat-card class="mat-elevation-z25">
  <mat-card-content>
    <form #form="ngForm">
      <mat-list>
        <mat-list-item>
          <mat-form-field class="url">
            <input
              matInput
              type="url"
              name="url"
              placeholder="Url"
              #urlModel="ngModel"
              [(ngModel)]="webhook.url"
              required
              pattern="^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?|^((http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"
            />
            <mat-hint>
              When this webhook triggered, Spica will send a POST request to the URL above.
            </mat-hint>
            <mat-error *ngIf="urlModel.errors?.pattern">Enter a valid url.</mat-error>
            <mat-error *ngIf="urlModel.errors?.required">Url is required.</mat-error>
          </mat-form-field>
        </mat-list-item>
        <h4 mat-subheader>
          Trigger
        </h4>
        <mat-list-item
          class="triggers"
          *ngIf="trigger.collections && trigger.collections.length > 0"
        >
          <mat-form-field>
            <mat-label>Collection</mat-label>
            <mat-select
              name="collection"
              [(ngModel)]="webhook.trigger.options.collection"
              #collectionModel="ngModel"
              required
            >
              <mat-option
                option
                *ngFor="let collection of trigger.collections"
                [value]="collection"
              >
                {{ collection }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="collectionModel.errors?.required">Collection is required.</mat-error>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Type</mat-label>
            <mat-select
              name="type"
              [(ngModel)]="webhook.trigger.options.type"
              #typeModel="ngModel"
              required
            >
              <mat-option option *ngFor="let type of trigger.types" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="typeModel.errors?.required">Type is required.</mat-error>
          </mat-form-field>
          <div class="status">
            <mat-label>
              {{ webhook.trigger.active ? "Active" : "Deactive" }}
            </mat-label>
            <mat-slide-toggle name="status" [(ngModel)]="webhook.trigger.active"></mat-slide-toggle>
          </div>
        </mat-list-item>
      </mat-list>
    </form>
  </mat-card-content>
  <mat-card-actions>
    <button
      [canInteract]="webhook._id ? 'webhook:update' : 'webhook:create'"
      mat-button
      [disabled]="form.invalid"
      (click)="save()"
    >
      <mat-icon>sync</mat-icon> Save
    </button>
  </mat-card-actions>
</mat-card>
